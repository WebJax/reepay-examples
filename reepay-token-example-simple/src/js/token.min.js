(function outer(modules,cache,entries){var global=function(){return this}();function require(name){if(cache[name])return cache[name].exports;if(modules[name])return call(name,require);throw new Error('cannot find module "'+name+'"')}function call(id,require){var m=cache[id]={exports:{}};var mod=modules[id];var name=mod[2];var fn=mod[0];var threw=true;try{fn.call(m.exports,function(req){var dep=modules[id][1][req];return require(dep||req)},m,m.exports,outer,modules,cache,entries);threw=false}finally{if(threw){delete cache[id]}else if(name){cache[name]=cache[id]}}return cache[id].exports}for(var id in entries){if(entries[id]){global[entries[id]]=require(id)}else{require(id)}}require.duo=true;require.cache=cache;require.modules=modules;return require})({1:[function(require,module,exports){var ReepayToken=require("./lib/reepay-token");module.exports=exports=new ReepayToken},{"./lib/reepay-token":2}],2:[function(require,module,exports){var merge=require("yields/merge:index.js");var type=require("component/type:index.js");var qs=require("visionmedia/node-querystring:index.js");var generator=require("./generator");var defaults={key:"",locale:"en",recurring:true,text:"Generate",frameID:"reepay-token-iframe",cardToken:function(cardToken){document.getElementById("reepay-card-token").setAttribute("value",cardToken.id)},baseUrl:"https://token.reepay.com/",ready:function(){}};module.exports=ReepayToken;var tokenHandler=function(token){defaults.cardToken(token)};var readyHandler=function(){defaults.ready()};var currentID=defaults.frameID;function ReepayToken(){this.script=document.currentScript;this.parent=this.script.parentElement;this.config=merge({},defaults);defaults.baseUrl=this.script.getAttribute("data-baseurl")?this.script.getAttribute("data-baseurl"):defaults.baseUrl;if(this.script.getAttribute("class")==="reepay-button"){if(!this.script.getAttribute("data-pubkey")){console.error("Please provide a public key in the script: data-pubkey='pub_myPublicKey'");return}this.config.key=this.script.getAttribute("data-pubkey");this.config.locale=this.script.getAttribute("data-locale")?this.script.getAttribute("data-locale"):defaults.locale;this.config.recurring=this.script.getAttribute("data-recurring")?this.script.getAttribute("data-recurring").toLowerCase():defaults.recurring;this.config.text=this.script.getAttribute("data-text")?this.script.getAttribute("data-text"):defaults.text;this.config.type=this.script.getAttribute("data-type")?this.script.getAttribute("data-type"):defaults.type;this.config.baseUrl=this.script.getAttribute("data-baseurl")?this.script.getAttribute("data-baseurl"):defaults.baseUrl;this.config.cardToken=defaults.cardToken;readyHandler=function(){document.querySelector("#reepay-token-button").disabled=false};this.generate();generator.generateResultField(this.parent);generator.generateButton(this.config.text,this.parent);this.showFrame()}}ReepayToken.prototype.generate=function(){generator.generateFrame(this.config.baseUrl,this.config.key,this.config.recurring,this.config.locale,this.config.frameID);generator.insertCSS();generator.addCSS(this.config.frameID);window.addEventListener("message",this.listen,false)};ReepayToken.prototype.showFrame=function(){self=this;document.getElementById("reepay-token-button").onclick=function(){self.open()}};ReepayToken.prototype.listen=function(){switch(event.data.action){case"close":generator.resetFrame(currentID);case"sendToken":var token=event.data.token;tokenHandler(token);generator.resetFrame(currentID);case"ready":console.log("Received ready (index.html)");readyHandler()}};ReepayToken.prototype.open=function(){currentID=this.config.frameID;document.querySelector("#"+this.config.frameID).style.visibility="visible";document.querySelector("#"+this.config.frameID).contentWindow.postMessage({action:"open"},"*")};ReepayToken.prototype.ready=function(){};ReepayToken.prototype.configure=function(options){return new ReepayHandle(options)};function ReepayHandle(options){this.reepaytoken=new ReepayToken;if(!options.key){console.error("It's necessary to provide a public key. See our documentation");return}this.reepaytoken.config.key=options.key;this.reepaytoken.config.recurring=options.recurring?options.recurring:defaults.recurring;this.reepaytoken.config.locale=options.locale?options.locale:defaults.locale;this.reepaytoken.config.cardToken=options.cardToken?options.cardToken:defaults.cardToken;this.reepaytoken.config.frameID=options.frameID?options.frameID:defaults.frameID;this.reepaytoken.config.ready=options.ready?options.ready:function(){};readyHandler=this.reepaytoken.config.ready;this.reepaytoken.generate();this.open=function(){tokenHandler=this.reepaytoken.config.cardToken;this.reepaytoken.open()}}},{"yields/merge:index.js":3,"component/type:index.js":4,"visionmedia/node-querystring:index.js":5,"./generator":6}],3:[function(require,module,exports){module.exports=function(a,b){for(var k in b)a[k]=b[k];return a}},{}],4:[function(require,module,exports){var toString=Object.prototype.toString;module.exports=function(val){switch(toString.call(val)){case"[object Date]":return"date";case"[object RegExp]":return"regexp";case"[object Arguments]":return"arguments";case"[object Array]":return"array";case"[object Error]":return"error"}if(val===null)return"null";if(val===undefined)return"undefined";if(val!==val)return"nan";if(val&&val.nodeType===1)return"element";if(isBuffer(val))return"buffer";val=val.valueOf?val.valueOf():Object.prototype.valueOf.apply(val);return typeof val};function isBuffer(obj){return!!(obj!=null&&(obj._isBuffer||obj.constructor&&typeof obj.constructor.isBuffer==="function"&&obj.constructor.isBuffer(obj)))}},{}],5:[function(require,module,exports){var toString=Object.prototype.toString;var hasOwnProperty=Object.prototype.hasOwnProperty;var indexOf=typeof Array.prototype.indexOf==="function"?function(arr,el){return arr.indexOf(el)}:function(arr,el){for(var i=0;i<arr.length;i++){if(arr[i]===el)return i}return-1};var isArray=Array.isArray||function(arr){return toString.call(arr)=="[object Array]"};var objectKeys=Object.keys||function(obj){var ret=[];for(var key in obj){if(obj.hasOwnProperty(key)){ret.push(key)}}return ret};var forEach=typeof Array.prototype.forEach==="function"?function(arr,fn){return arr.forEach(fn)}:function(arr,fn){for(var i=0;i<arr.length;i++)fn(arr[i])};var reduce=function(arr,fn,initial){if(typeof arr.reduce==="function")return arr.reduce(fn,initial);var res=initial;for(var i=0;i<arr.length;i++)res=fn(res,arr[i]);return res};var isint=/^[0-9]+$/;function promote(parent,key){if(parent[key].length==0)return parent[key]={};var t={};for(var i in parent[key]){if(hasOwnProperty.call(parent[key],i)){t[i]=parent[key][i]}}parent[key]=t;return t}function parse(parts,parent,key,val){var part=parts.shift();if(Object.getOwnPropertyDescriptor(Object.prototype,key))return;if(!part){if(isArray(parent[key])){parent[key].push(val)}else if("object"==typeof parent[key]){parent[key]=val}else if("undefined"==typeof parent[key]){parent[key]=val}else{parent[key]=[parent[key],val]}}else{var obj=parent[key]=parent[key]||[];if("]"==part){if(isArray(obj)){if(""!=val)obj.push(val)}else if("object"==typeof obj){obj[objectKeys(obj).length]=val}else{obj=parent[key]=[parent[key],val]}}else if(~indexOf(part,"]")){part=part.substr(0,part.length-1);if(!isint.test(part)&&isArray(obj))obj=promote(parent,key);parse(parts,obj,part,val)}else{if(!isint.test(part)&&isArray(obj))obj=promote(parent,key);parse(parts,obj,part,val)}}}function merge(parent,key,val){if(~indexOf(key,"]")){var parts=key.split("["),len=parts.length,last=len-1;parse(parts,parent,"base",val)}else{if(!isint.test(key)&&isArray(parent.base)){var t={};for(var k in parent.base)t[k]=parent.base[k];parent.base=t}set(parent.base,key,val)}return parent}function compact(obj){if("object"!=typeof obj)return obj;if(isArray(obj)){var ret=[];for(var i in obj){if(hasOwnProperty.call(obj,i)){ret.push(obj[i])}}return ret}for(var key in obj){obj[key]=compact(obj[key])}return obj}function parseObject(obj){var ret={base:{}};forEach(objectKeys(obj),function(name){merge(ret,name,obj[name])});return compact(ret.base)}function parseString(str){var ret=reduce(String(str).split("&"),function(ret,pair){var eql=indexOf(pair,"="),brace=lastBraceInKey(pair),key=pair.substr(0,brace||eql),val=pair.substr(brace||eql,pair.length),val=val.substr(indexOf(val,"=")+1,val.length);if(""==key)key=pair,val="";if(""==key)return ret;return merge(ret,decode(key),decode(val))},{base:{}}).base;return compact(ret)}exports.parse=function(str){if(null==str||""==str)return{};return"object"==typeof str?parseObject(str):parseString(str)};var stringify=exports.stringify=function(obj,prefix){if(isArray(obj)){return stringifyArray(obj,prefix)}else if("[object Object]"==toString.call(obj)){return stringifyObject(obj,prefix)}else if("string"==typeof obj){return stringifyString(obj,prefix)}else{return prefix+"="+encodeURIComponent(String(obj))}};function stringifyString(str,prefix){if(!prefix)throw new TypeError("stringify expects an object");return prefix+"="+encodeURIComponent(str)}function stringifyArray(arr,prefix){var ret=[];if(!prefix)throw new TypeError("stringify expects an object");for(var i=0;i<arr.length;i++){ret.push(stringify(arr[i],prefix+"["+i+"]"))}return ret.join("&")}function stringifyObject(obj,prefix){var ret=[],keys=objectKeys(obj),key;for(var i=0,len=keys.length;i<len;++i){key=keys[i];if(""==key)continue;if(null==obj[key]){ret.push(encodeURIComponent(key)+"=")}else{ret.push(stringify(obj[key],prefix?prefix+"["+encodeURIComponent(key)+"]":encodeURIComponent(key)))}}return ret.join("&")}function set(obj,key,val){var v=obj[key];if(Object.getOwnPropertyDescriptor(Object.prototype,key))return;if(undefined===v){obj[key]=val}else if(isArray(v)){v.push(val)}else{obj[key]=[v,val]}}function lastBraceInKey(str){var len=str.length,brace,c;for(var i=0;i<len;++i){c=str[i];if("]"==c)brace=false;if("["==c)brace=true;if("="==c&&!brace)return i}}function decode(str){try{return decodeURIComponent(str.replace(/\+/g," "))}catch(err){return str}}},{}],6:[function(require,module,exports){module.exports={generateButton:function(buttonText,parent){var button=document.createElement("button");button.setAttribute("type","button");button.setAttribute("id","reepay-token-button");button.innerHTML=buttonText;button.disabled=true;parent.appendChild(button)},generateFrame:function(baseUrl,publicKey,recurring,locale,id){var iframe=document.createElement("iframe");iframe.setAttribute("src",baseUrl+locale+"?pubkey="+publicKey+"&recurring="+recurring);iframe.setAttribute("id",id);document.body.appendChild(iframe)},generateResultField:function(parent){var field=document.createElement("input");field.setAttribute("type","hidden");field.setAttribute("id","reepay-card-token");parent.appendChild(field)},addCSS:function(id){var element=document.getElementById(id);element.setAttribute("style","visibility: hidden; "+"display: block; "+"width: 100%; "+"height: 100%; "+"overflow-x: hidden; "+"overflow-y: auto; "+"margin:0; "+"padding:0; "+"position: fixed; "+"top:0; "+"left:0; "+"border: none; "+"background: rgba(0,0,0, .004); "+"-webkit-tap-highlight-color: transparent;")},insertCSS:function(){var style=document.createElement("style");var css="#reepay-token-button {"+"background: rgb(40,167,113);"+"color: ghostwhite;"+"border: none;"+"border-radius: 3px;"+"padding: 10px 10px;"+"}";if(style.styleSheet){style.styleSheet.cssText=css}else{style.appendChild(document.createTextNode(css))}document.getElementsByTagName("head")[0].appendChild(style)},resetFrame:function(id){document.querySelector("#"+id).style.visibility="hidden";document.querySelector("#"+id).src=document.querySelector("#"+id).src}}},{}]},{},{1:"reepaytoken"});